{
  "id": "https://raw.githubusercontent.com/FabienGilbert/AzureHub/master/nsg/nsg_armTemplate_schema.json#",
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "NSG Template at subscription scope",
  "description": "A Network Security Group deployment template at subscription scope",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON schema reference"
    },
    "contentVersion": {
      "type": "string",
      "pattern": "(^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$)",
      "description": "A 4 number format for the version number of this template file. For example, 1.0.0.0"
    },
    "parameters": {
      "type": "object",
      "description": "Input parameter definitions",
      "additionalProperties": {
        "$ref": "#/definitions/parameter"
      }
    },
    "variables": {
      "type": "object",
      "description": "Variable definitions",
      "properties": {
        "securityRules": {
          "type": "object",
          "description": "Network Security Group Security Rules",
          "properties": {
            "value": {
              "type": "array",
              "items": {
                "properties": {
                  "direction": {
                    "type": "string",
                    "enum": [
                      "inbound",
                      "outbound"
                    ],
                    "description": "Traffic direction this rule is to apply on"
                  },
                  "priority": {
                    "type": "integer",
                    "minimum": 100,
                    "maximum": 4096,
                    "description": "Rule Priority. Start at 200. Space them out by 10. Space deny rules by 500."
                  },
                  "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 80,
                    "description": "Short rule name. Alphanumeric, hyphen, underscore, and period only.",
                    "pattern": "^[A-Za-z0-9]{1}[A-Za-z0-9-_.]*[A-Za-z_]{1}$"
                  },
                  "description": {
                    "type": "string",
                    "description": "Detailed description of what the rule is for."
                  },
                  "access": {
                    "type": "string",
                    "enum": [
                      "allow",
                      "deny"
                    ],
                    "description": "allow or deny traffic."
                  },
                  "sourceAddressPrefix": {
                    "type": "string",
                    "description": "Either a single Source Address/Service Tag",
                    "examples": [
                      "Internet",
                      "VirtualNetwork",
                      "AzureLoadBalancer",
                      "10.184.226.0/27",
                      "*",
                      ""
                    ],
                    "default": ""
                  },
                  "sourceAddressPrefixes": {
                    "type": "array",
                    "description": "Or an array of several Source Addresses",
                    "default": [],
                    "examples": [
                      [
                        "10.184.226.0/27",
                        "10.184.228.0/27"
                      ]
                    ]
                  },
                  "sourceApplicationSecurityGroups": {
                    "type": "array",
                    "description": "SourceApplicationSecurityGroups",
                    "default": []
                  },
                  "destinationAddressPrefix": {
                    "type": "string",
                    "description": "Either a single Destination Address/Service Tag",
                    "examples": [
                      "Internet",
                      "VirtualNetwork",
                      "10.184.226.0/27",
                      "*",
                      ""
                    ],
                    "default": ""
                  },
                  "destinationAddressPrefixes": {
                    "type": "array",
                    "description": "Or an array of several Destination Addresses",
                    "default": [],
                    "examples": [
                      [
                        "10.184.226.0/27",
                        "10.184.228.0/27"
                      ]
                    ]
                  },
                  "protocol": {
                    "type": "string",
                    "description": "Protocol the rule is applying on",
                    "enum": [
                      "tcp",
                      "udp",
                      "*"
                    ]
                  },
                  "sourcePortRange": {
                    "type": "string",
                    "description": "Either a single Source Port Range",
                    "default": "*",
                    "pattern": "^[0-9-*]*$",
                    "examples": [
                      "",
                      "5555",
                      "49152-65535"
                    ]
                  },
                  "sourcePortRanges": {
                    "type": "array",
                    "description": "Or an array of Source Port Ranges",
                    "default": [],
                    "items": {
                      "pattern": "^[0-9]{1}[0-9-]*$"
                    },
                    "examples": [
                      [
                        "5555",
                        "49152-65535"
                      ],
                      [
                        "6666",
                        "7777",
                        "1024-65535"
                      ]
                    ]
                  },
                  "destinationPortRange": {
                    "type": "string",
                    "description": "Either a single Destination Port Range",
                    "default": "*",
                    "pattern": "^[0-9-*]*$",
                    "examples": [
                      "443",
                      "49152-65535"
                    ]
                  },
                  "destinationPortRanges": {
                    "type": "array",
                    "description": "Or an array of Destination Port Ranges",
                    "default": [],
                    "items": {
                      "pattern": "^[0-9]{1}[0-9-]*$"
                    },
                    "examples": [
                      [
                        "3389",
                        "5985-5986"
                      ],
                      [
                        "53",
                        "88",
                        "135",
                        "137-139",
                        "389",
                        "445",
                        "464",
                        "636",
                        "3268",
                        "3269",
                        "49152-65535"
                      ]
                    ]
                  }
                },
                "required": [
                  "direction",
                  "priority",
                  "name",
                  "description",
                  "access",
                  "sourceAddressPrefix",
                  "sourceAddressPrefixes",
                  "destinationAddressPrefix",
                  "destinationAddressPrefixes",
                  "protocol",
                  "sourcePortRange",
                  "sourcePortRanges",
                  "destinationPortRange",
                  "destinationPortRanges"
                ],
                "defaultSnippets": [
                  {
                    "label": "New Security Rule",
                    "description": "Creates a new Security Rule template",
                    "body": {
                      "direction": "${1|inbound,outbound|}",
                      "priority": "^$2",
                      "name": "$3",
                      "description": "$4",
                      "access": "${5|allow,deny|}",
                      "protocol": "${6|tcp,udp,*|}",
                      "sourceAddressPrefix": "$7",
                      "sourceAddressPrefixes": "^$8",
                      "destinationAddressPrefix": "$9",
                      "destinationAddressPrefixes": "^$10",
                      "sourcePortRange": "*",
                      "sourcePortRanges": [],
                      "destinationPortRange": "$11",
                      "destinationPortRanges": "^$12"
                    }
                  }
                ],
                "additionalProperties": false
              }
            }
          },
          "additionalProperties": false
        }
      },
      "required": [
        "securityRules"
      ]
    },
    "functions": {
        "type": "array",
        "items": {
            "$ref": "#/definitions/functionNamespace"
        },
        "description": "User defined functions"
    },
    "resources": {
        "type": "array",
        "description": "Collection of resources to be deployed",
        "items": {
            "allOf": [
                {
                    "$ref": "#/definitions/resourceBase"
                },
                {
                    "oneOf": [
                        {
                            "$ref": "https://schema.management.azure.com/schemas/2019-08-01/Microsoft.Resources.json#/subscription_resourceDefinitions/deployments"
                        }
                    ]
                }
            ]
        }
    },
    "outputs": {
        "type": "object",
        "description": "Output parameter definitions"
    }
  },
  "required": [
    "$schema",
    "contentVersion",
    "parameters",
    "variables",
    "resources"
  ],
  "additionalProperties": false
}